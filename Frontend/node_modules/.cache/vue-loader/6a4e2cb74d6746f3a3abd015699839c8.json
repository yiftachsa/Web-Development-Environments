{"remainingRequest":"C:\\scripts\\Courses_Scripts\\Internet_Programing_Environments\\Project\\assignment-3-2-v2-yiftach-merav\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\scripts\\Courses_Scripts\\Internet_Programing_Environments\\Project\\assignment-3-2-v2-yiftach-merav\\src\\pages\\MyMealPage.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"C:\\scripts\\Courses_Scripts\\Internet_Programing_Environments\\Project\\assignment-3-2-v2-yiftach-merav\\src\\pages\\MyMealPage.vue","mtime":1595183243479},{"path":"C:\\scripts\\Courses_Scripts\\Internet_Programing_Environments\\Project\\assignment-3-2-v2-yiftach-merav\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\scripts\\Courses_Scripts\\Internet_Programing_Environments\\Project\\assignment-3-2-v2-yiftach-merav\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\scripts\\Courses_Scripts\\Internet_Programing_Environments\\Project\\assignment-3-2-v2-yiftach-merav\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\scripts\\Courses_Scripts\\Internet_Programing_Environments\\Project\\assignment-3-2-v2-yiftach-merav\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\scripts\\Courses_Scripts\\Internet_Programing_Environments\\Project\\assignment-3-2-v2-yiftach-merav\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQouc29ydGFibGUgew0KICB3aWR0aDogMTAwJTsNCiAgYmFja2dyb3VuZDogcmdiKDIzMSwgMjMxLCAyMzEpOw0KICBwYWRkaW5nOiAxZW07DQogIGJvcmRlci1yYWRpdXM6IDVweDsNCiAgY3Vyc29yOiBtb3ZlOw0KICBtYXJnaW4tYm90dG9tOiAzcHg7DQp9DQoNCi5mbGlwLWxpc3QtbW92ZSB7DQogIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjVzOw0KfQ0KLnJpZ2h0IHsNCiAgZmxvYXQ6IHJpZ2h0Ow0KfQ0KDQouZ2hvc3Qgew0KICBib3JkZXItbGVmdDogNnB4IHNvbGlkIHJnYigwLCAxODMsIDI1NSk7DQogIGJveC1zaGFkb3c6IDEwcHggMTBweCA1cHggLTFweCByZ2JhKDAsIDAsIDAsIDAuMTQpOw0KICBvcGFjaXR5OiAwLjc7DQp9DQouaGVsbG8gLnNvcnRhYmxlLWRyYWcgew0KICBvcGFjaXR5OiAwOw0KfQ0KDQouaW1nU3R5bGUgew0KICAvKiBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDc0LCA3NSwgNzUsIDAuNSk7DQogIHBhZGRpbmc6IDVweDsNCiAgd2lkdGg6IDE1MHB4OyAqLw0KICBib3JkZXItcmFkaXVzOiAxMHB4Ow0KICBjdXJzb3I6IHBvaW50ZXI7DQogIHdpZHRoOiAyMjBweDsNCn0NCg0KLmltZ1N0eWxlOmhvdmVyIHsNCiAgYm94LXNoYWRvdzogMCAwIDJweCAxcHggcmdiYSgwLCAxNDAsIDE4NiwgMC41KTsNCg0KfQ0KLnRleHRTdHlsZSB7DQogIGZvbnQtZmFtaWx5OiBEb3NpcywgSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsNCiAgZm9udC1zaXplOiAxLjhyZW07DQogIGZvbnQtd2VpZ2h0OiA2MDA7DQp9DQo="},{"version":3,"sources":["MyMealPage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"MyMealPage.vue","sourceRoot":"src/pages","sourcesContent":["<template>\r\n  <div class=\"textStyle\">\r\n    <h1 class=\"title\">My Meal</h1>\r\n    <br />\r\n    <br />\r\n    <div v-if=\"noMealPlan\">\r\n      <br />\r\n      <b-alert show dismissible fade>No recipes in meal plan</b-alert>\r\n    </div>\r\n    <draggable v-else v-model=\"recipes\" ghost-class=\"ghost\" @end=\"onEnd\">\r\n      <transition-group type=\"transition\" name=\"flip-list\">\r\n        <div\r\n          class=\"sortable\"\r\n          :id=\"element.recipeId\"\r\n          v-for=\"(element,counter) in recipes\"\r\n          :key=\"element.recipeId\"\r\n        >\r\n          <RemoveMealRecipe\r\n            :recipe=\"element.recipeId\"\r\n            v-on:recipe-removed=\"updateRecipesAfterRemove\"\r\n          />\r\n\r\n          <b-card no-body class=\"overflow-hidden\">\r\n            <b-row no-gutters>\r\n              <router-link\r\n                :to=\"{\r\n                name: 'prepare-recipe',\r\n                params: { recipeId: element.recipeId, type: recipeType },\r\n               }\"\r\n              >\r\n                <b-col md=\"2.5\">\r\n                  <b-card-img :src=\"element.photo\" alt=\"Image\" class=\"rounded-0 imgStyle\"></b-card-img>\r\n                </b-col>\r\n              </router-link>\r\n              <b-col md=\"6\">\r\n                <b-card-body :title=\"element.title\">\r\n                  <b-card-text>\r\n                    {{counter+1}}\r\n                    <RecipeProgress :recipe=\"element.recipeId\" />\r\n                  </b-card-text>\r\n                </b-card-body>\r\n              </b-col>\r\n            </b-row>\r\n          </b-card>\r\n\r\n          <span class=\"right\"></span>\r\n        </div>\r\n      </transition-group>\r\n    </draggable>\r\n    <RemoveAllMeal v-if=\"noMealPlan == false\" v-on:recipes-clear=\"clearData\" />\r\n    <!-- <VerticalRecipePreview :recipes=\"recipes\" v-on:Clear-Recipes=\"clearAllRecipes\" /> -->\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport draggable from \"vuedraggable\";\r\nimport RemoveMealRecipe from \"../components/RemoveMealRecipe\";\r\nimport RemoveAllMeal from \"../components/RemoveAllMeal.vue\";\r\nimport RecipeProgress from \"../components/recipeProgress\";\r\n\r\nexport default {\r\n  name: \"MyMealPage\",\r\n  components: {\r\n    //VerticalRecipePreview,\r\n    draggable,\r\n    RemoveMealRecipe,\r\n    RemoveAllMeal,\r\n    RecipeProgress\r\n  },\r\n  data() {\r\n    return {\r\n      recipes: [],\r\n      oldIndex: \"\",\r\n      newIndex: \"\",\r\n      noMealPlan: false,\r\n      recipeType: \"Number\"\r\n    };\r\n  },\r\n  async mounted() {\r\n    if(this.$root.store.getMyMeal()!=undefined)\r\n    {\r\n      this.recipes = this.$root.store.getMyMeal();\r\n      let size = await this.size()\r\n      if(this.recipes.length != size)\r\n      {\r\n        this.updateRecipes();\r\n      }\r\n    }\r\n    else\r\n    {\r\n      this.updateRecipes();\r\n\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    async size()\r\n    {\r\n      if ($cookies.get(\"session\")) {\r\n        try {\r\n          const response = await this.axios.get(\r\n            `${this.$root.store.baseUrl}/user/mealPlan/getMealPlanSize`\r\n          );\r\n          const mealSize = response.data;\r\n          return mealSize.size;\r\n        } catch (error) {\r\n          console.log(error);\r\n        }\r\n      } else {\r\n        this.$router.push(\"/\").catch(() => {\r\n          this.$forceUpdate();\r\n        });\r\n      }\r\n    },\r\n    async updateRecipes() {\r\n      if ($cookies.get(\"session\")) {\r\n        try {\r\n          const response = await this.axios.get(\r\n            `${this.$root.store.baseUrl}/user/mealPlan/getMealPlan`\r\n          );\r\n          const recipesDetails = response.data;\r\n          this.recipes = [];\r\n          this.recipesDetails = [];\r\n          let recipes = [];\r\n          for (let index = 0; index < recipesDetails.length; index++) {\r\n            recipes.push(\r\n              this.axios.get(\r\n                `${this.$root.store.baseUrl}/recipes/preview/simplePreview/recipeID/${recipesDetails[index].recipe_id}`\r\n              )\r\n            );\r\n          }\r\n          if (recipesDetails.length == 0) {\r\n            this.noMealPlan = true;\r\n          }\r\n          let recipesAfter = [];\r\n          await Promise.all(recipes).then(values => {\r\n            recipesAfter.push(...values);\r\n          });\r\n          let recipesAfterLoad = [];\r\n\r\n          for (let index = 0; index < recipesAfter.length; index++) {\r\n            recipesAfterLoad.push(recipesAfter[index].data);\r\n          }\r\n          let orderdRecipes = [];\r\n          for (let index = 1; index <= recipesAfterLoad.length; index++) {\r\n            let position = recipesDetails.find(\r\n              element => element.position == index\r\n            ).recipe_id;\r\n\r\n            orderdRecipes.push(\r\n              recipesAfterLoad.find(element => element.recipeId === position)\r\n            );\r\n          }\r\n\r\n          this.recipes.push(...orderdRecipes);\r\n          this.$root.store.saveMyMeal(this.recipes);\r\n\r\n        } catch (error) {\r\n          console.log(error);\r\n        }\r\n      } else {\r\n        this.$router.push(\"/\").catch(() => {\r\n          this.$forceUpdate();\r\n        });\r\n      }\r\n    },\r\n    clearData() {\r\n      this.recipes = [];\r\n      this.$emit(\"updateSize\");\r\n    },\r\n    async updateOrder() {\r\n      let reorderRecipes = [];\r\n      for (let index = 0; index < this.recipes.length; index++) {\r\n        let recipeId = this.recipes[index].recipeId;\r\n        let recipeOrderInfo = {\r\n          position: index + 1,\r\n          recipe_id: recipeId\r\n        };\r\n        reorderRecipes.push(recipeOrderInfo);\r\n      }\r\n      let request = JSON.stringify(reorderRecipes);\r\n      if ($cookies.get(\"session\")) {\r\n        const response = await this.axios.put(\r\n          `${this.$root.store.baseUrl}/user/mealPlan/reorder/recipesNewOrder`,\r\n          reorderRecipes\r\n        );\r\n      this.$root.store.saveMyMeal(this.recipes);\r\n      } else {\r\n        this.$router.push(\"/\").catch(() => {\r\n          this.$forceUpdate();\r\n        });\r\n      }\r\n      // },\r\n    },\r\n    updateRecipesAfterRemove(recipeId) {\r\n      let recipeIndexToRemove = this.recipes.find(\r\n        element => element.recipeId === recipeId\r\n      );\r\n      let idx = this.recipes.indexOf(recipeIndexToRemove);\r\n      this.recipes.splice(idx, 1);\r\n      this.$emit(\"updateSize\");\r\n    },\r\n    onEnd: async function(evt) {\r\n      this.oldIndex = evt.oldIndex;\r\n      this.newIndex = evt.newIndex;\r\n\r\n      await this.updateOrder();\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n\r\n<style>\r\n.sortable {\r\n  width: 100%;\r\n  background: rgb(231, 231, 231);\r\n  padding: 1em;\r\n  border-radius: 5px;\r\n  cursor: move;\r\n  margin-bottom: 3px;\r\n}\r\n\r\n.flip-list-move {\r\n  transition: transform 0.5s;\r\n}\r\n.right {\r\n  float: right;\r\n}\r\n\r\n.ghost {\r\n  border-left: 6px solid rgb(0, 183, 255);\r\n  box-shadow: 10px 10px 5px -1px rgba(0, 0, 0, 0.14);\r\n  opacity: 0.7;\r\n}\r\n.hello .sortable-drag {\r\n  opacity: 0;\r\n}\r\n\r\n.imgStyle {\r\n  /* border: 1px solid rgba(74, 75, 75, 0.5);\r\n  padding: 5px;\r\n  width: 150px; */\r\n  border-radius: 10px;\r\n  cursor: pointer;\r\n  width: 220px;\r\n}\r\n\r\n.imgStyle:hover {\r\n  box-shadow: 0 0 2px 1px rgba(0, 140, 186, 0.5);\r\n\r\n}\r\n.textStyle {\r\n  font-family: Dosis, Helvetica, Arial, sans-serif;\r\n  font-size: 1.8rem;\r\n  font-weight: 600;\r\n}\r\n</style>"]}]}